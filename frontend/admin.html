<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Administrativo - Entregadores 67</title>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Oswald:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    
    <!-- Script de inicializa√ß√£o -->
    <script>
        // Configura√ß√µes globais
        window.APP_CONFIG = {
            BACKEND_URL: 'https://entregador67-production.up.railway.app',
            VERSION: '2.0.0',
            ENVIRONMENT: 'production'
        };

        // Definir BACKEND_URL globalmente
        window.BACKEND_URL = window.APP_CONFIG.BACKEND_URL;

        console.log('üöÄ Sistema Entregadores67 - Painel Admin inicializando...');
        console.log('üîó Backend URL:', window.BACKEND_URL);
    </script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    
    <style>
        /* Estilos espec√≠ficos para o painel administrativo */
        .admin-container {
            display: grid;
            grid-template-columns: 250px 1fr;
            min-height: 100vh;
        }

        .admin-sidebar {
            background: rgba(10, 10, 10, 0.95);
            color: white;
            padding: 20px 0;
            border-right: 1px solid #333;
        }

        .admin-logo {
            text-align: center;
            padding: 20px;
            border-bottom: 1px solid #333;
            margin-bottom: 20px;
        }

        .admin-logo h2 {
            color: #d4af37;
            font-family: 'Bebas Neue', cursive;
            font-size: 1.8rem;
            letter-spacing: 2px;
        }

        .admin-nav ul {
            list-style: none;
            padding: 0;
        }

        .admin-nav li {
            margin: 0;
        }

        .admin-nav a {
            display: block;
            color: #ddd;
            text-decoration: none;
            padding: 15px 25px;
            transition: all 0.3s;
            border-left: 3px solid transparent;
        }

        .admin-nav a:hover,
        .admin-nav a.active {
            background: rgba(212, 175, 55, 0.1);
            color: #d4af37;
            border-left-color: #d4af37;
        }

        .admin-nav .nav-icon {
            margin-right: 10px;
            font-size: 1.1rem;
        }

        .admin-main {
            background: rgba(17, 17, 17, 0.9);
            padding: 20px;
            overflow-y: auto;
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #333;
        }

        .admin-title {
            color: #d4af37;
            font-family: 'Bebas Neue', cursive;
            font-size: 2.5rem;
            letter-spacing: 2px;
        }

        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(10, 10, 10, 0.8);
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #333;
            text-align: center;
            transition: all 0.3s;
        }

        .stat-card:hover {
            border-color: #d4af37;
            transform: translateY(-2px);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #d4af37;
            margin-bottom: 10px;
        }

        .stat-label {
            color: #aaa;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .admin-section {
            background: rgba(10, 10, 10, 0.8);
            border-radius: 8px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid #333;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #333;
        }

        .section-title {
            color: #d4af37;
            font-size: 1.5rem;
            font-weight: bold;
        }

        .upload-area {
            border: 3px dashed #d4af37;
            border-radius: 10px;
            padding: 40px 20px;
            text-align: center;
            background: rgba(212, 175, 55, 0.05);
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 20px;
        }

        .upload-area:hover {
            background: rgba(212, 175, 55, 0.1);
        }

        .upload-area.dragover {
            background: rgba(212, 175, 55, 0.15);
            border-color: #f4c542;
        }

        .upload-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            color: #d4af37;
        }

        .upload-text {
            color: #ddd;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .file-input {
            display: none;
        }

        .file-status {
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
            font-size: 0.9rem;
        }

        .file-status.success {
            background: rgba(39, 174, 96, 0.2);
            color: #27ae60;
            border: 1px solid #27ae60;
        }

        .file-status.error {
            background: rgba(231, 76, 60, 0.2);
            color: #e74c3c;
            border: 1px solid #e74c3c;
        }

        .filters {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-btn {
            background: transparent;
            color: #ddd;
            border: 2px solid #333;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .filter-btn:hover,
        .filter-btn.active {
            background: #d4af37;
            color: #0a0a0a;
            border-color: #d4af37;
        }

        .pedidos-grid,
        .entregadores-grid {
            display: grid;
            gap: 15px;
        }

        .pedido-card,
        .entregador-card {
            background: rgba(17, 17, 17, 0.8);
            border: 1px solid #333;
            border-radius: 8px;
            padding: 20px;
            transition: all 0.3s;
        }

        .pedido-card:hover,
        .entregador-card:hover {
            border-color: #d4af37;
            transform: translateY(-2px);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .card-title {
            color: #d4af37;
            font-size: 1.2rem;
            font-weight: bold;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            text-transform: uppercase;
        }

        .status-pendente {
            background: rgba(243, 156, 18, 0.2);
            color: #f39c12;
            border: 1px solid #f39c12;
        }

        .status-aceito {
            background: rgba(52, 152, 219, 0.2);
            color: #3498db;
            border: 1px solid #3498db;
        }

        .status-entregue {
            background: rgba(39, 174, 96, 0.2);
            color: #27ae60;
            border: 1px solid #27ae60;
        }

        .status-aprovado {
            background: rgba(39, 174, 96, 0.2);
            color: #27ae60;
            border: 1px solid #27ae60;
        }

        .status-rejeitado {
            background: rgba(231, 76, 60, 0.2);
            color: #e74c3c;
            border: 1px solid #e74c3c;
        }

        .card-content {
            margin-bottom: 15px;
        }

        .card-content p {
            margin: 5px 0;
            color: #ddd;
        }

        .card-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn-action {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s;
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-warning {
            background: #f39c12;
            color: white;
        }

        .btn-info {
            background: #3498db;
            color: white;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }

        .empty-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        @media (max-width: 768px) {
            .admin-container {
                grid-template-columns: 1fr;
            }

            .admin-sidebar {
                display: none;
            }

            .admin-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .filters {
                flex-direction: column;
            }

            .card-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <!-- Sidebar -->
        <aside class="admin-sidebar">
            <div class="admin-logo">
                <h2>ENTREGADORES 67</h2>
                <p style="color: #aaa; font-size: 0.8rem;">Painel Administrativo</p>
            </div>
            
            <nav class="admin-nav">
                <ul>
                    <li><a href="#dashboard" class="active"><span class="nav-icon">üìä</span> Dashboard</a></li>
                    <li><a href="#pedidos"><span class="nav-icon">üì¶</span> Gerenciar Pedidos</a></li>
                    <li><a href="#entregadores"><span class="nav-icon">üë§</span> Entregadores</a></li>
                    <li><a href="#importar"><span class="nav-icon">üìÅ</span> Importar JSON</a></li>
                    <li><a href="index.html"><span class="nav-icon">üè†</span> Voltar ao Site</a></li>
                </ul>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="admin-main">
            <!-- Header -->
            <div class="admin-header">
                <h1 class="admin-title">PAINEL ADMINISTRATIVO</h1>
                <div class="user-area">
                    <div id="nav-buttons" class="nav-buttons" style="display: none;">
                        <button onclick="window.location.href='index.html'" class="btn-nav">
                            üè† In√≠cio
                        </button>
                    </div>
                    <div class="user-info">
                        <img id="user-avatar" src="" alt="Avatar" class="user-avatar">
                        <span id="user-name" class="user-name"></span>
                        <button id="logout-btn" class="btn-logout">Sair</button>
                    </div>
                </div>
            </div>

            <!-- Dashboard Section -->
            <section id="dashboard" class="admin-section">
                <h2 class="section-title">üìä Dashboard</h2>
                
                <div class="admin-stats">
                    <div class="stat-card">
                        <div class="stat-number" id="total-pedidos">0</div>
                        <div class="stat-label">Total de Pedidos</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="pedidos-pendentes">0</div>
                        <div class="stat-label">Pedidos Pendentes</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="entregadores-ativos">0</div>
                        <div class="stat-label">Entregadores Ativos</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="pedidos-entregues">0</div>
                        <div class="stat-label">Pedidos Entregues</div>
                    </div>
                </div>
            </section>

            <!-- Importar JSON Section -->
            <section id="importar" class="admin-section" style="display: none;">
                <div class="section-header">
                    <h2 class="section-title">üìÅ IMPORTAR PEDIDOS DO GARAGEM67</h2>
                </div>

                <div class="upload-area" id="drop-area">
                    <div class="upload-icon">üìÅ</div>
                    <div class="upload-text">Arraste arquivos JSON aqui ou clique para selecionar</div>
                    <button class="btn-primary" id="select-files">SELECIONAR ARQUIVOS</button>
                    <input type="file" id="file-input" accept=".json" multiple class="file-input">
                </div>

                <div id="upload-status"></div>

                <div class="how-it-works">
                    <h3 style="color: #d4af37; margin-bottom: 15px;">Como funciona:</h3>
                    <ul style="color: #aaa; list-style: none; padding-left: 0;">
                        <li style="margin-bottom: 8px;">‚Ä¢ Selecione os arquivos JSON grandes pelo Garagem67</li>
                        <li style="margin-bottom: 8px;">‚Ä¢ Os pedidos ser√£o automaticamente importados</li>
                        <li style="margin-bottom: 8px;">‚Ä¢ Cada pedido ficar√° dispon√≠vel para os entregadores</li>
                    </ul>
                </div>
            </section>

            <!-- Gerenciar Pedidos Section -->
            <section id="pedidos" class="admin-section" style="display: none;">
                <div class="section-header">
                    <h2 class="section-title">üì¶ GERENCIAR PEDIDOS</h2>
                    <button class="btn-primary" id="btn-atualizar-pedidos">üîÑ Atualizar</button>
                </div>

                <div class="filters">
                    <button class="filter-btn active" data-status="todos">Todos</button>
                    <button class="filter-btn" data-status="pendente">Pendentes</button>
                    <button class="filter-btn" data-status="aceito">Aceitos</button>
                    <button class="filter-btn" data-status="entregue">Entregues</button>
                    <button class="filter-btn" data-status="json_upload">JSON Upload</button>
                </div>

                <div id="lista-pedidos-admin" class="pedidos-grid">
                    <!-- Pedidos ser√£o carregados aqui -->
                </div>
            </section>

            <!-- Entregadores Section -->
            <section id="entregadores" class="admin-section" style="display: none;">
                <div class="section-header">
                    <h2 class="section-title">üë§ GERENCIAR ENTREGADORES</h2>
                    <button class="btn-primary" id="btn-atualizar-entregadores">üîÑ Atualizar</button>
                </div>

                <div class="filters">
                    <button class="filter-btn active" data-status="todos">Todos</button>
                    <button class="filter-btn" data-status="pendente">Pendentes</button>
                    <button class="filter-btn" data-status="aprovado">Aprovados</button>
                    <button class="filter-btn" data-status="rejeitado">Rejeitados</button>
                </div>

                <div id="lista-entregadores" class="entregadores-grid">
                    <!-- Entregadores ser√£o carregados aqui -->
                </div>
            </section>
        </main>
    </div>

    <!-- Scripts -->
    <script>
        // ==================== CONFIGURA√á√ÉO FIREBASE ====================
        const firebaseConfig = {
            apiKey: "AIzaSyAO2fMl8KCASY_oTqX5PeHnM4ivBSOFcYQ",
            authDomain: "entregador67-859a4.firebaseapp.com",
            projectId: "entregador67-859a4",
            storageBucket: "entregador67-859a4.firebasestorage.app",
            messagingSenderId: "314820422641",
            appId: "1:314820422641:web:12685b9bf66287a7aaf250",
            measurementId: "G-H6TN06K0XK"
        };

        // Inicializar Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const auth = firebase.auth();

        // ==================== VARI√ÅVEIS GLOBAIS ====================
        let currentUser = null;
        let userToken = null;
        let allPedidos = [];
        let allEntregadores = [];

        // ==================== INICIALIZA√á√ÉO ====================
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Inicializando Painel Administrativo...');
            initAdmin();
            initNavigation();
            initJSONUpload();
        });

        // ==================== SISTEMA DE AUTENTICA√á√ÉO ====================
        async function initAdmin() {
            auth.onAuthStateChanged(async (user) => {
                if (user) {
                    currentUser = user;
                    userToken = await user.getIdToken();
                    
                    // Verificar se √© admin
                    if (await verificarAdmin()) {
                        showUserInfo(user);
                        await carregarDashboard();
                        showSection('dashboard');
                    } else {
                        alert('‚ùå Acesso negado. Apenas administradores podem acessar esta p√°gina.');
                        window.location.href = 'index.html';
                    }
                } else {
                    window.location.href = 'index.html';
                }
            });
        }

        async function verificarAdmin() {
            try {
                const response = await fetch(`${window.BACKEND_URL}/entregadores`, {
                    headers: {
                        'Authorization': `Bearer ${userToken}`
                    }
                });
                return response.ok;
            } catch (error) {
                console.error('‚ùå Erro ao verificar admin:', error);
                return false;
            }
        }

        function showUserInfo(user) {
            const userName = document.getElementById('user-name');
            const userAvatar = document.getElementById('user-avatar');
            const logoutBtn = document.getElementById('logout-btn');

            if (userName) userName.textContent = user.displayName || user.email;
            if (userAvatar) userAvatar.src = user.photoURL || 'https://via.placeholder.com/40';
            
            if (logoutBtn) {
                logoutBtn.addEventListener('click', () => {
                    auth.signOut();
                    window.location.href = 'index.html';
                });
            }
        }

        // ==================== NAVEGA√á√ÉO ====================
        function initNavigation() {
            // Navega√ß√£o entre se√ß√µes
            const navLinks = document.querySelectorAll('.admin-nav a');
            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const sectionId = link.getAttribute('href').substring(1);
                    
                    // Atualizar links ativos
                    navLinks.forEach(l => l.classList.remove('active'));
                    link.classList.add('active');
                    
                    // Mostrar se√ß√£o correspondente
                    showSection(sectionId);
                });
            });

            // Bot√£o atualizar pedidos
            const btnAtualizarPedidos = document.getElementById('btn-atualizar-pedidos');
            if (btnAtualizarPedidos) {
                btnAtualizarPedidos.addEventListener('click', carregarPedidosAdmin);
            }

            // Bot√£o atualizar entregadores
            const btnAtualizarEntregadores = document.getElementById('btn-atualizar-entregadores');
            if (btnAtualizarEntregadores) {
                btnAtualizarEntregadores.addEventListener('click', carregarEntregadores);
            }

            // Filtros
            const filterBtns = document.querySelectorAll('.filter-btn');
            filterBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    filterBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    
                    const status = btn.getAttribute('data-status');
                    if (document.querySelector('#pedidos').style.display !== 'none') {
                        filtrarPedidos(status);
                    } else if (document.querySelector('#entregadores').style.display !== 'none') {
                        filtrarEntregadores(status);
                    }
                });
            });
        }

        function showSection(sectionId) {
            // Esconder todas as se√ß√µes
            const sections = document.querySelectorAll('.admin-section');
            sections.forEach(section => {
                section.style.display = 'none';
            });

            // Mostrar se√ß√£o selecionada
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.style.display = 'block';
                
                // Carregar dados espec√≠ficos da se√ß√£o
                switch(sectionId) {
                    case 'dashboard':
                        carregarDashboard();
                        break;
                    case 'pedidos':
                        carregarPedidosAdmin();
                        break;
                    case 'entregadores':
                        carregarEntregadores();
                        break;
                    case 'importar':
                        // J√° inicializado
                        break;
                }
            }
        }

        // ==================== DASHBOARD ====================
        async function carregarDashboard() {
            try {
                // Carregar pedidos
                const pedidosResponse = await fetch(`${window.BACKEND_URL}/pedidos`, {
                    headers: {
                        'Authorization': `Bearer ${userToken}`
                    }
                });

                if (pedidosResponse.ok) {
                    const result = await pedidosResponse.json();
                    if (result.success) {
                        const pedidos = result.data;
                        
                        // Atualizar estat√≠sticas
                        document.getElementById('total-pedidos').textContent = pedidos.length;
                        document.getElementById('pedidos-pendentes').textContent = 
                            pedidos.filter(p => p.status === 'pendente').length;
                        document.getElementById('pedidos-entregues').textContent = 
                            pedidos.filter(p => p.status === 'entregue').length;
                    }
                }

                // Carregar entregadores
                const entregadoresResponse = await fetch(`${window.BACKEND_URL}/entregadores`, {
                    headers: {
                        'Authorization': `Bearer ${userToken}`
                    }
                });

                if (entregadoresResponse.ok) {
                    const result = await entregadoresResponse.json();
                    if (result.success) {
                        const entregadores = result.data;
                        document.getElementById('entregadores-ativos').textContent = 
                            entregadores.filter(e => e.status === 'aprovado').length;
                    }
                }

            } catch (error) {
                console.error('‚ùå Erro ao carregar dashboard:', error);
            }
        }

        // ==================== GERENCIAR PEDIDOS ====================
        async function carregarPedidosAdmin() {
            try {
                const response = await fetch(`${window.BACKEND_URL}/pedidos`, {
                    headers: {
                        'Authorization': `Bearer ${userToken}`
                    }
                });

                if (response.ok) {
                    const result = await response.json();
                    if (result.success) {
                        allPedidos = result.data;
                        aplicarFiltroPedidos();
                    }
                } else {
                    throw new Error('Erro ao carregar pedidos');
                }
            } catch (error) {
                console.error('‚ùå Erro ao carregar pedidos:', error);
                showNotification('‚ùå Erro ao carregar pedidos', 'error');
            }
        }

        function aplicarFiltroPedidos() {
            const activeFilter = document.querySelector('#pedidos .filter-btn.active');
            const status = activeFilter ? activeFilter.getAttribute('data-status') : 'todos';
            filtrarPedidos(status);
        }

        function filtrarPedidos(status) {
            let pedidosFiltrados = allPedidos;

            if (status !== 'todos') {
                if (status === 'json_upload') {
                    pedidosFiltrados = allPedidos.filter(pedido => 
                        pedido.source === 'json_upload' || pedido.source === 'garagem67'
                    );
                } else {
                    pedidosFiltrados = allPedidos.filter(pedido => pedido.status === status);
                }
            }

            exibirPedidosAdmin(pedidosFiltrados);
        }

        function exibirPedidosAdmin(pedidos) {
            const container = document.getElementById('lista-pedidos-admin');
            if (!container) return;

            if (pedidos.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üìù</div>
                        <h3>Nenhum pedido encontrado</h3>
                        <p>${getMensagemEstadoVazioPedidos()}</p>
                    </div>
                `;
                return;
            }

            // Ordenar por data (mais recente primeiro)
            pedidos.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));

            container.innerHTML = pedidos.map(pedido => `
                <div class="pedido-card">
                    <div class="card-header">
                        <div class="card-title">Pedido #${pedido.id.substring(0, 8)}</div>
                        <div class="status-badge status-${pedido.status}">
                            ${formatarStatus(pedido.status)}
                        </div>
                    </div>
                    
                    <div class="card-content">
                        <p><strong>üì¶ Descri√ß√£o:</strong> ${pedido.description}</p>
                        <p><strong>üî¢ Quantidade:</strong> ${pedido.quantity}</p>
                        
                        ${pedido.customer ? `
                            <p><strong>üë§ Cliente:</strong> ${pedido.customer.name}</p>
                            <p><strong>üìû Telefone:</strong> ${pedido.customer.phone}</p>
                        ` : ''}
                        
                        ${pedido.total ? `<p><strong>üí∞ Total:</strong> R$ ${parseFloat(pedido.total).toFixed(2)}</p>` : ''}
                        
                        <p><strong>üïê Criado em:</strong> ${formatarData(pedido.createdAt)}</p>
                        
                        ${pedido.acceptedByName ? `
                            <p><strong>‚úÖ Aceito por:</strong> ${pedido.acceptedByName}</p>
                        ` : ''}
                    </div>
                    
                    <div class="card-actions">
                        ${pedido.status === 'pendente' ? `
                            <button class="btn-action btn-danger" onclick="excluirPedido('${pedido.id}')">
                                üóëÔ∏è Excluir
                            </button>
                        ` : ''}
                        
                        ${pedido.status === 'aceito' ? `
                            <button class="btn-action btn-warning" onclick="atualizarStatusPedido('${pedido.id}', 'em_rota')">
                                üöö Em Rota
                            </button>
                        ` : ''}
                        
                        ${pedido.status === 'em_rota' ? `
                            <button class="btn-action btn-success" onclick="atualizarStatusPedido('${pedido.id}', 'entregue')">
                                ‚úÖ Entregue
                            </button>
                        ` : ''}
                        
                        <button class="btn-action btn-info" onclick="verDetalhesPedido('${pedido.id}')">
                            üìã Detalhes
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // ==================== GERENCIAR ENTREGADORES ====================
        async function carregarEntregadores() {
            try {
                const response = await fetch(`${window.BACKEND_URL}/entregadores`, {
                    headers: {
                        'Authorization': `Bearer ${userToken}`
                    }
                });

                if (response.ok) {
                    const result = await response.json();
                    if (result.success) {
                        allEntregadores = result.data;
                        aplicarFiltroEntregadores();
                    }
                } else {
                    throw new Error('Erro ao carregar entregadores');
                }
            } catch (error) {
                console.error('‚ùå Erro ao carregar entregadores:', error);
                showNotification('‚ùå Erro ao carregar entregadores', 'error');
            }
        }

        function aplicarFiltroEntregadores() {
            const activeFilter = document.querySelector('#entregadores .filter-btn.active');
            const status = activeFilter ? activeFilter.getAttribute('data-status') : 'todos';
            filtrarEntregadores(status);
        }

        function filtrarEntregadores(status) {
            let entregadoresFiltrados = allEntregadores;

            if (status !== 'todos') {
                entregadoresFiltrados = allEntregadores.filter(entregador => entregador.status === status);
            }

            exibirEntregadores(entregadoresFiltrados);
        }

        function exibirEntregadores(entregadores) {
            const container = document.getElementById('lista-entregadores');
            if (!container) return;

            if (entregadores.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üë§</div>
                        <h3>Nenhum entregador encontrado</h3>
                        <p>${getMensagemEstadoVazioEntregadores()}</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = entregadores.map(entregador => `
                <div class="entregador-card">
                    <div class="card-header">
                        <div class="card-title">${entregador.nome}</div>
                        <div class="status-badge status-${entregador.status}">
                            ${formatarStatusEntregador(entregador.status)}
                        </div>
                    </div>
                    
                    <div class="card-content">
                        <p><strong>üìß Email:</strong> ${entregador.userEmail}</p>
                        <p><strong>üìû Telefone:</strong> ${formatarTelefone(entregador.telefone)}</p>
                        <p><strong>üöó Ve√≠culo:</strong> ${formatarVeiculo(entregador.veiculo)}</p>
                        <p><strong>üìç Localiza√ß√£o:</strong> ${entregador.cidade} - ${entregador.estado}</p>
                        <p><strong>üïê Cadastrado em:</strong> ${formatarData(entregador.dataCadastro)}</p>
                    </div>
                    
                    <div class="card-actions">
                        ${entregador.status === 'pendente' ? `
                            <button class="btn-action btn-success" onclick="aprovarEntregador('${entregador.id}')">
                                ‚úÖ Aprovar
                            </button>
                            <button class="btn-action btn-danger" onclick="rejeitarEntregador('${entregador.id}')">
                                ‚ùå Rejeitar
                            </button>
                        ` : ''}
                        
                        ${entregador.status === 'aprovado' ? `
                            <button class="btn-action btn-warning" onclick="suspenderEntregador('${entregador.id}')">
                                ‚è∏Ô∏è Suspender
                            </button>
                        ` : ''}
                        
                        ${(entregador.status === 'rejeitado' || entregador.status === 'suspenso') ? `
                            <button class="btn-action btn-success" onclick="reativarEntregador('${entregador.id}')">
                                üîÑ Reativar
                            </button>
                        ` : ''}
                        
                        <button class="btn-action btn-info" onclick="verDetalhesEntregador('${entregador.id}')">
                            üëÅÔ∏è Detalhes
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // ==================== UPLOAD DE JSON ====================
        function initJSONUpload() {
            const dropArea = document.getElementById('drop-area');
            const fileInput = document.getElementById('file-input');
            const selectButton = document.getElementById('select-files');

            // Event listeners para drag and drop
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, preventDefaults, false);
            });

            ['dragenter', 'dragover'].forEach(eventName => {
                dropArea.addEventListener(eventName, () => highlight(dropArea), false);
            });

            ['dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, () => unhighlight(dropArea), false);
            });

            dropArea.addEventListener('drop', handleDrop, false);

            // Event listeners para sele√ß√£o de arquivos
            selectButton.addEventListener('click', () => fileInput.click(), false);
            fileInput.addEventListener('change', (e) => handleFiles(e.target.files), false);

            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            function highlight(element) {
                element.classList.add('dragover');
            }

            function unhighlight(element) {
                element.classList.remove('dragover');
            }

            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                handleFiles(files);
            }

            function handleFiles(files) {
                if (!files.length) return;

                console.log(`üìÇ ${files.length} arquivo(s) selecionado(s)`);
                showNotification(`üìÇ ${files.length} arquivo(s) selecionado(s)`, 'info');

                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    processFile(file);
                }
            }

            async function processFile(file) {
                console.log('üîÑ Processando arquivo:', file.name);

                // Verificar se √© um arquivo JSON
                if (!file.name.endsWith('.json')) {
                    showError(file.name, 'Arquivo n√£o √© um JSON');
                    return;
                }

                try {
                    // Validar o JSON
                    const jsonContent = await validateJSON(file);
                    
                    // Enviar para o backend
                    await uploadToBackend(file, jsonContent);
                    
                } catch (error) {
                    console.error('‚ùå Erro ao processar arquivo:', error);
                    showError(file.name, error.message);
                }
            }

            function validateJSON(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();

                    reader.onload = (e) => {
                        try {
                            const json = JSON.parse(e.target.result);
                            
                            // Validar estrutura b√°sica do JSON
                            if (!json.customer) {
                                throw new Error('JSON n√£o possui customer');
                            }
                            if (!json.items || !Array.isArray(json.items)) {
                                throw new Error('JSON n√£o possui items array');
                            }
                            
                            resolve(json);
                        } catch (error) {
                            reject(new Error(`JSON inv√°lido: ${error.message}`));
                        }
                    };

                    reader.onerror = () => reject(new Error('Erro ao ler arquivo'));
                    reader.readAsText(file);
                });
            }

            async function uploadToBackend(file, jsonContent) {
                try {
                    showNotification(`üì§ Enviando ${file.name}...`, 'info');

                    const response = await fetch(`${window.BACKEND_URL}/api/upload-json`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${userToken}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            fileName: file.name,
                            fileContent: jsonContent
                        })
                    });

                    const result = await response.json();

                    if (result.success) {
                        showSuccess(file.name);
                        showNotification('‚úÖ Arquivo processado com sucesso!', 'success');
                        
                        // Recarregar a lista de pedidos se estiver na se√ß√£o de pedidos
                        if (document.querySelector('#pedidos').style.display !== 'none') {
                            carregarPedidosAdmin();
                        }
                    } else {
                        throw new Error(result.message);
                    }

                } catch (error) {
                    console.error('‚ùå Erro ao enviar para backend:', error);
                    throw new Error(`Falha no upload: ${error.message}`);
                }
            }

            function showError(fileName, message) {
                updateStatus(fileName, `‚ùå Erro: ${message}`, 'error');
                showNotification(`‚ùå Erro em ${fileName}: ${message}`, 'error');
            }

            function showSuccess(fileName) {
                updateStatus(fileName, '‚úÖ Importado com sucesso!', 'success');
            }

            function updateStatus(fileName, message, type) {
                const statusContainer = document.getElementById('upload-status');
                const statusElement = document.createElement('div');
                statusElement.className = `file-status ${type}`;
                statusElement.textContent = `${fileName}: ${message}`;
                statusContainer.appendChild(statusElement);
            }
        }

        // ==================== FUN√á√ïES ADMINISTRATIVAS ====================
        async function excluirPedido(pedidoId) {
            if (!confirm('Tem certeza que deseja excluir este pedido? Esta a√ß√£o n√£o pode ser desfeita.')) return;
            
            try {
                const response = await fetch(`${window.BACKEND_URL}/pedidos/${pedidoId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${userToken}`
                    }
                });

                if (response.ok) {
                    showNotification('‚úÖ Pedido exclu√≠do com sucesso!', 'success');
                    carregarPedidosAdmin();
                } else {
                    throw new Error('Erro ao excluir pedido');
                }
            } catch (error) {
                console.error('‚ùå Erro ao excluir pedido:', error);
                showNotification('‚ùå Erro ao excluir pedido.', 'error');
            }
        }

        async function atualizarStatusPedido(pedidoId, novoStatus) {
            try {
                const response = await fetch(`${window.BACKEND_URL}/pedidos/${pedidoId}/status`, {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${userToken}`
                    },
                    body: JSON.stringify({ status: novoStatus })
                });

                const result = await response.json();

                if (result.success) {
                    showNotification(`‚úÖ Status do pedido atualizado para: ${formatarStatus(novoStatus)}`, 'success');
                    carregarPedidosAdmin();
                } else {
                    throw new Error(result.message);
                }
            } catch (error) {
                console.error('‚ùå Erro ao atualizar status:', error);
                showNotification('‚ùå Erro ao atualizar status: ' + error.message, 'error');
            }
        }

        async function aprovarEntregador(entregadorId) {
            if (!confirm('Deseja aprovar este entregador?')) return;
            
            try {
                const response = await fetch(`${window.BACKEND_URL}/entregadores/${entregadorId}/aprovar`, {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${userToken}`
                    },
                    body: JSON.stringify({ aprovado: true })
                });

                if (response.ok) {
                    showNotification('‚úÖ Entregador aprovado com sucesso!', 'success');
                    carregarEntregadores();
                } else {
                    throw new Error('Erro ao aprovar entregador');
                }
            } catch (error) {
                console.error('‚ùå Erro ao aprovar entregador:', error);
                showNotification('‚ùå Erro ao aprovar entregador.', 'error');
            }
        }

        async function rejeitarEntregador(entregadorId) {
            if (!confirm('Deseja rejeitar este entregador?')) return;
            
            try {
                const response = await fetch(`${window.BACKEND_URL}/entregadores/${entregadorId}/aprovar`, {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${userToken}`
                    },
                    body: JSON.stringify({ aprovado: false })
                });

                if (response.ok) {
                    showNotification('‚ùå Entregador rejeitado.', 'success');
                    carregarEntregadores();
                } else {
                    throw new Error('Erro ao rejeitar entregador');
                }
            } catch (error) {
                console.error('‚ùå Erro ao rejeitar entregador:', error);
                showNotification('‚ùå Erro ao rejeitar entregador.', 'error');
            }
        }

        function suspenderEntregador(entregadorId) {
            showNotification('‚è∏Ô∏è Funcionalidade de suspens√£o em desenvolvimento', 'info');
        }

        function reativarEntregador(entregadorId) {
            showNotification('üîÑ Funcionalidade de reativa√ß√£o em desenvolvimento', 'info');
        }

        function verDetalhesPedido(pedidoId) {
            const pedido = allPedidos.find(p => p.id === pedidoId);
            if (pedido) {
                const detalhes = JSON.stringify(pedido, null, 2);
                console.log('üìã Detalhes completos do pedido:', pedido);
                alert('Detalhes do pedido (ver console para informa√ß√µes completas)');
            }
        }

        function verDetalhesEntregador(entregadorId) {
            showNotification('üë§ Visualizando detalhes do entregador', 'info');
        }

        // ==================== FUN√á√ïES AUXILIARES ====================
        function formatarData(dataString) {
            if (!dataString) return 'N/A';
            const data = new Date(dataString);
            return data.toLocaleString('pt-BR', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function formatarStatus(status) {
            const statusMap = {
                'pendente': '‚è≥ Pendente',
                'aceito': '‚úÖ Aceito',
                'em_rota': 'üöö Em Rota',
                'entregue': 'üéâ Entregue',
                'cancelado': '‚ùå Cancelado'
            };
            return statusMap[status] || status;
        }

        function formatarStatusEntregador(status) {
            const statusMap = {
                'pendente': '‚è≥ Pendente',
                'aprovado': '‚úÖ Aprovado',
                'rejeitado': '‚ùå Rejeitado',
                'suspenso': '‚è∏Ô∏è Suspenso'
            };
            return statusMap[status] || status;
        }

        function formatarTelefone(telefone) {
            if (!telefone) return 'N/A';
            const cleaned = telefone.replace(/\D/g, '');
            if (cleaned.length === 11) {
                return `(${cleaned.substring(0,2)}) ${cleaned.substring(2,7)}-${cleaned.substring(7)}`;
            }
            return telefone;
        }

        function formatarVeiculo(veiculo) {
            const veiculoMap = {
                'moto': 'üèçÔ∏è Moto',
                'carro': 'üöó Carro',
                'bicicleta': 'üö¥ Bicicleta',
                'caminhao': 'üöö Caminh√£o'
            };
            return veiculoMap[veiculo] || veiculo;
        }

        function getMensagemEstadoVazioPedidos() {
            const activeFilter = document.querySelector('#pedidos .filter-btn.active');
            const status = activeFilter ? activeFilter.getAttribute('data-status') : 'todos';
            
            const messages = {
                'todos': 'N√£o h√° pedidos no sistema.',
                'pendente': 'N√£o h√° pedidos pendentes no momento.',
                'aceito': 'N√£o h√° pedidos aceitos no momento.',
                'entregue': 'N√£o h√° pedidos entregues no momento.',
                'json_upload': 'N√£o h√° pedidos importados do Garagem67.'
            };
            
            return messages[status] || 'N√£o h√° pedidos para o filtro selecionado.';
        }

        function getMensagemEstadoVazioEntregadores() {
            const activeFilter = document.querySelector('#entregadores .filter-btn.active');
            const status = activeFilter ? activeFilter.getAttribute('data-status') : 'todos';
            
            const messages = {
                'todos': 'N√£o h√° entregadores cadastrados.',
                'pendente': 'N√£o h√° entregadores pendentes de aprova√ß√£o.',
                'aprovado': 'N√£o h√° entregadores aprovados.',
                'rejeitado': 'N√£o h√° entregadores rejeitados.'
            };
            
            return messages[status] || 'N√£o h√° entregadores para o filtro selecionado.';
        }

        function showNotification(message, type = 'info') {
            // Remover notifica√ß√µes existentes
            document.querySelectorAll('.notification').forEach(notification => {
                notification.remove();
            });

            // Criar notifica√ß√£o
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <span>${message}</span>
                <button class="notification-close" onclick="this.parentElement.remove()">√ó</button>
            `;

            // Adicionar estilos se n√£o existirem
            if (!document.querySelector('#notification-styles')) {
                const styles = document.createElement('style');
                styles.id = 'notification-styles';
                styles.textContent = `
                    .notification {
                        position: fixed;
                        top: 100px;
                        right: 20px;
                        padding: 15px 20px;
                        border-radius: 8px;
                        font-weight: bold;
                        z-index: 10000;
                        max-width: 400px;
                        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        animation: slideInRight 0.3s ease;
                    }
                    .notification.success {
                        background: #27ae60;
                        color: white;
                    }
                    .notification.error {
                        background: #e74c3c;
                        color: white;
                    }
                    .notification.info {
                        background: #3498db;
                        color: white;
                    }
                    .notification.warning {
                        background: #f39c12;
                        color: white;
                    }
                    .notification-close {
                        background: none;
                        border: none;
                        color: white;
                        font-size: 1.2em;
                        cursor: pointer;
                        margin-left: 10px;
                    }
                    @keyframes slideInRight {
                        from {
                            transform: translateX(400px);
                            opacity: 0;
                        }
                        to {
                            transform: translateX(0);
                            opacity: 1;
                        }
                    }
                `;
                document.head.appendChild(styles);
            }

            document.body.appendChild(notification);

            // Remover automaticamente ap√≥s 5 segundos
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 5000);
        }

        // Exportar fun√ß√µes para uso global
        window.excluirPedido = excluirPedido;
        window.atualizarStatusPedido = atualizarStatusPedido;
        window.aprovarEntregador = aprovarEntregador;
        window.rejeitarEntregador = rejeitarEntregador;
        window.suspenderEntregador = suspenderEntregador;
        window.reativarEntregador = reativarEntregador;
        window.verDetalhesPedido = verDetalhesPedido;
        window.verDetalhesEntregador = verDetalhesEntregador;
    </script>
</body>
</html>